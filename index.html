<!DOCTYPE html>

<html lang="pt-br">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Jogo Hebraico Bíblico – Rodrigo Niskier</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css?family=JetBrains+Mono:400,700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew:wght@400;700&display=swap">

  <style>

    body { font-family: 'JetBrains Mono', monospace; background: #222c36; }

    canvas { background: transparent; display: block; margin: 0 auto; touch-action: none; }

    .hebrew { font-family: 'Noto Sans Hebrew', sans-serif; font-size: 2.2rem; direction: rtl; }

    .modal-bg { background: rgba(0,0,0,0.7); }

    .slide-in { animation: slide-in 1.1s cubic-bezier(0.4,0,0.2,1);}

    @keyframes slide-in { from { transform: translateY(-30px); opacity:0; } to { transform: translateY(0); opacity:1; } }

    .char-choice { transition: transform 0.18s; }

    .char-choice.selected { transform: scale(1.13); border: 3px solid #2563eb; box-shadow: 0 0 0 4px #2563eb55; z-index: 2; }

    .lives-heart { color: #ff4141; font-size: 2rem; margin-right: 0.3em; }

    @media (max-width: 600px) { #game { margin-top: 10px !important; } }

  </style>

</head>

<body class="flex flex-col items-center min-h-screen bg-gray-900">



  <!-- Tela Inicial -->

  <div id="startScreen" class="fixed inset-0 bg-gray-950 flex flex-col items-center justify-center z-50">

    <div class="bg-gray-100 rounded-2xl p-8 shadow-2xl flex flex-col items-center gap-6 w-[360px]">

      <h1 class="text-2xl font-bold text-gray-900 mb-2">Bem-vindo ao Jogo de Hebraico Bíblico!</h1>

      <div class="flex flex-col gap-2 w-full">

        <label class="text-gray-800 font-semibold mb-1 text-base" for="username">Seu nome de jogador:</label>

        <input id="username" type="text" maxlength="18" autocomplete="off" class="w-full px-4 py-2 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 text-lg text-gray-800" placeholder="Digite seu nome..."/>

      </div>

      <div class="w-full">

        <span class="font-semibold text-gray-800 mb-2 block">Escolha seu personagem:</span>

        <div class="flex flex-row gap-7 justify-center mt-1">

          <button id="char1" class="char-choice rounded-full border-2 border-gray-300 p-1 bg-white focus:outline-none">

            <img src="personagem1.png" alt="Personagem 1" class="w-20 h-20 object-cover rounded-full"/>

          </button>

          <button id="char2" class="char-choice rounded-full border-2 border-gray-300 p-1 bg-white focus:outline-none">

            <img src="personagem2.png" alt="Personagem 2" class="w-20 h-20 object-cover rounded-full"/>

          </button>

        </div>

      </div>

      <button id="playBtn" class="mt-2 w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition text-lg disabled:bg-gray-300 disabled:text-gray-400 disabled:cursor-not-allowed" disabled>Play</button>

    </div>

  </div>



  <!-- Tela de Comandos -->

  <div id="commandScreen" class="fixed inset-0 bg-gray-900/90 flex flex-col items-center justify-center z-50 hidden">

    <div class="bg-white rounded-2xl shadow-2xl w-[340px] p-8 flex flex-col items-center gap-6">

      <h2 class="text-2xl font-bold text-blue-800 mb-2">Comandos do Jogo</h2>

      <ul class="text-gray-900 text-base text-left leading-7 mb-3">

        <li><b>Movimentar:</b> <span class="bg-gray-200 rounded px-1">←</span> <span class="bg-gray-200 rounded px-1">→</span> (ou botões laterais)</li>

        <li><b>Pular:</b> <span class="bg-gray-200 rounded px-1">↑</span> (ou botão "↑")</li>

        <li><b>Atirar Cruz:</b> <span class="bg-gray-200 rounded px-1">barra de espaço</span> (ou botão com cruz ✝️)</li>

        <li><b>Coletar palavra:</b> encoste nela</li>

        <li><b>Derrote vilões:</b> atire a cruz neles</li>

        <li><b>Power-up:</b> pegue יָד ("iad") para ganhar poder (100 pontos e brilho especial)</li>

        <li><b>Vidas:</b> você tem 3 corações (perde vida se ficar com pontos negativos após colidir com vilão)</li>

        <li><b>Game Over:</b> se perder todas as vidas</li>

        <li><b>Vitória:</b> colete todas as palavras e derrote todos os vilões</li>

      </ul>

      <button id="okBtn" class="w-full px-5 py-2 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition">OK</button>

    </div>

  </div>



  <!-- HUD Pontos e Vidas -->

  <div id="scoreHud" class="fixed top-5 right-8 text-xl text-white z-20 flex items-center gap-7" style="display:none;">

    <div class="bg-gray-700 px-5 py-2 rounded-2xl shadow-lg font-bold flex items-center gap-2">Pontos: <span id="scoreValue">0</span></div>

    <div id="lives" class="flex items-center"></div>

  </div>

  <canvas id="game" width="900" height="440" class="rounded-2xl border-2 border-gray-800 shadow-2xl mt-10" style="display:none;"></canvas>



  <!-- Controles Touch -->

  <div id="touchControls" class="fixed left-0 bottom-0 w-full flex justify-between items-end px-6 pb-5 z-30" style="display:none;">

    <div class="flex gap-3">

      <button class="bg-gray-700/80 text-white rounded-full w-16 h-16 text-3xl flex items-center justify-center active:bg-blue-600" id="btnLeft" tabindex="-1">←</button>

      <button class="bg-gray-700/80 text-white rounded-full w-16 h-16 text-3xl flex items-center justify-center active:bg-blue-600" id="btnRight" tabindex="-1">→</button>

    </div>

    <div class="flex gap-3">

      <button class="bg-gray-700/80 text-white rounded-full w-16 h-16 text-3xl flex items-center justify-center active:bg-blue-600" id="btnUp" tabindex="-1">↑</button>

      <button class="bg-yellow-500 text-white rounded-full w-16 h-16 text-2xl flex items-center justify-center active:bg-yellow-600" id="btnFire" tabindex="-1">✝️</button>

    </div>

  </div>



  <!-- Modal de Desafio -->

  <div id="modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">

    <div class="modal-bg absolute inset-0"></div>

    <div class="relative p-8 bg-gray-100 rounded-xl shadow-2xl w-[350px] slide-in">

      <div class="flex flex-col items-center gap-4">

        <span class="text-lg text-gray-900 font-semibold">Traduza a palavra:</span>

        <span id="hebrewWord" class="hebrew text-4xl text-gray-900"></span>

        <form id="answerForm" class="w-full flex flex-col gap-3 items-center">

          <input type="text" id="answerInput" autocomplete="off" placeholder="Digite a tradução..." class="w-full px-4 py-2 rounded-lg border-2 border-gray-300 focus:outline-none focus:border-blue-500 text-lg text-gray-800">

          <div class="flex flex-row gap-4 w-full justify-between items-center">

            <button type="button" id="hintBtn" class="px-3 py-1 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold rounded-lg transition">Dica</button>

            <button type="submit" class="px-5 py-2 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition">Responder</button>

          </div>

        </form>

        <div id="feedback" class="text-base text-red-600 font-semibold mt-2 min-h-[28px]"></div>

        <div id="hint" class="text-gray-800 text-sm font-medium"></div>

        <div id="timer" class="text-gray-700 text-xs mt-1"></div>

      </div>

    </div>

  </div>



  <!-- Tela Fim de Jogo -->

  <div id="endModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">

    <div class="modal-bg absolute inset-0"></div>

    <div class="relative p-8 bg-white rounded-xl shadow-2xl w-[370px] slide-in text-center">

      <h2 id="endTitle" class="text-2xl text-blue-800 font-bold mb-4"></h2>

      <p id="endMsg" class="mb-2 text-lg"></p>

      <button onclick="window.location.reload()" class="mt-4 px-5 py-2 bg-blue-600 text-white rounded-lg font-semibold shadow hover:bg-blue-700 transition">Jogar novamente</button>

    </div>

  </div>



<script>

/*  

TODO: Por limite de espaço, vou te entregar em 2 partes:

- Parte 1: Toda a configuração, tela inicial, palavras, layout e funções até o setup do mundo.

- Parte 2 (responda "continue" para receber): Engine principal, movimentação do mundo (personagem centralizado), detecção de colisão, controle de vidas, disparo, desafio, HUD, etc.

*/



/* ---------- Parte 1 ---------- */



// ======== Utils ========

function isMobile() {

  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

}

function normalize(str) {

  return str

    .toLowerCase()

    .normalize('NFD')

    .replace(/[\u0300-\u036f]/g, '')

    .replace(/[^a-zA-Z0-9ãõç\s]/g, '')

    .trim();

}



// ======== Tela Inicial & Comando ========

let selectedChar = 0, playerName = "", usedHint = false;

const charBtns = [document.getElementById('char1'), document.getElementById('char2')];

function updatePlayBtnState() {

  document.getElementById('playBtn').disabled = !(playerName.length > 0 && selectedChar > 0);

}

charBtns.forEach((btn, idx) => {

  btn.addEventListener('click', () => {

    selectedChar = idx + 1;

    charBtns.forEach((b, j) => b.classList.toggle('selected', j === idx));

    updatePlayBtnState();

  });

});

document.getElementById('username').addEventListener('input', function() {

  playerName = this.value.trim();

  updatePlayBtnState();

});

document.getElementById('playBtn').addEventListener('click', function() {

  document.getElementById('startScreen').style.display = "none";

  document.getElementById('commandScreen').style.display = "flex";

});

document.getElementById('okBtn').addEventListener('click', function() {

  document.getElementById('commandScreen').style.display = "none";

  document.getElementById('game').style.display = "";

  document.getElementById('scoreHud').style.display = "";

  if (isMobile()) document.getElementById('touchControls').style.display = "flex";

  else document.getElementById('touchControls').style.display = "none";

  startGame();

});



// ======== Palavras ========

const charImgs = [

  "personagem1.png",

  "personagem2.png",

  "personagem3.png"

];

const backgroundImageUrl = "fundo.jpg";

const WORDS = [

  {he:"בֵּן", tr:"ben", pt:["filho","menino","descendente"], dica:"Parentesco masculino"},

  {he:"בָּנִים", tr:"banim", pt:["filhos","meninos","descendentes"], dica:"Plural de filho"},

  {he:"אִשָּׁה", tr:"ishá", pt:["mulher","esposa"], dica:"Feminino de homem"},

  {he:"אִישׁ", tr:"ish", pt:["homem","marido"], dica:"Masculino adulto"},

  {he:"נָבִיא", tr:"navi", pt:["profeta"], dica:"Homem que fala por Deus"},

  {he:"מֶלֶךְ", tr:"melekh", pt:["rei"], dica:"Soberano do povo"},

  {he:"מַלְכָּה", tr:"malká", pt:["rainha"], dica:"Soberana do povo"},

  {he:"אֵם", tr:"em", pt:["mãe"], dica:"Progenitora feminina"},

  {he:"אָב", tr:"av", pt:["pai","ancestral"], dica:"Progenitor masculino"},

  {he:"תַּלְמִיד", tr:"talmid", pt:["discípulo","aluno"], dica:"Segue o mestre"},

  {he:"אָמַר", tr:"amar", pt:["disse","falar","falou","dizer"], dica:"Expressar palavras"},

  {he:"הָלַךְ", tr:"halakh", pt:["andou","andar","caminhou","caminhar"], dica:"Locomoção"},

  {he:"אָמְרוּ", tr:"amru", pt:["disseram","falaram"], dica:"Plural de disse"},

  {he:"שָׁמַע", tr:"shama", pt:["ouviu","ouvir"], dica:"Sentido de escutar"},

  {he:"יָשַׁב", tr:"yashav", pt:["sentou","assentar","habitou","morar","residir"], dica:"Ficar em um lugar"},

  {he:"אָכַל", tr:"akal", pt:["comeu","comer"], dica:"Ato de comer"},

  {he:"לָקַח", tr:"lakach", pt:["pegou","tomou","pegar","tomar"], dica:"Ato de tomar algo"},

  {he:"רָאָה", tr:"ra'ah", pt:["viu","ver"], dica:"Perceber com os olhos"},

  {he:"אֵת", tr:"et", pt:["com","junto de","com o"], dica:"Preposição - junto de"},

  {he:"בְּתוֹךְ", tr:"betoch", pt:["dentro","em meio a"], dica:"No interior de algo"},

  {he:"עִם", tr:"im", pt:["com"], dica:"Junto de"},

  {he:"עַל", tr:"al", pt:["sobre","em cima de","acima"], dica:"Em cima"},

  {he:"אֶל", tr:"el", pt:["para","até"], dica:"Direção, movimento"},

  {he:"לִפְנֵי", tr:"lifnei", pt:["antes de","diante de"], dica:"Antes no tempo ou espaço"},

  {he:"דָּבָר", tr:"davar", pt:["palavra","coisa","assunto"], dica:"O que se diz"},

  {he:"עִיר", tr:"ir", pt:["cidade"], dica:"Lugar urbano"},

  {he:"שָׁלוֹם", tr:"shalom", pt:["paz","bem-estar","segurança"], dica:"Desejo de paz"},

  {he:"שָׁנָה", tr:"shanah", pt:["ano"], dica:"Tempo de 12 meses"},

  {he:"מַיִם", tr:"mayim", pt:["água","águas"], dica:"Líquido essencial"},

  {he:"עֵין", tr:"ayin", pt:["olho","vista"], dica:"Sentido da visão"},

  {he:"יָד", tr:"yad", pt:["mão","poder"], dica:"Parte do corpo / poder", power:true}

];



let gameElements = [];

function setupMapElements() {

  let shuffledWords = WORDS.filter(w=>!w.power).sort(()=>Math.random()-0.5);

  let yadsToAdd = 10, wordsToAdd = 30;

  let powerSpacing = 3, vilaoSpacing = 3, vilaoStart = 7;

  let elements = [], idx=0, yads=0, vilaos=0;

  for (let i=0; i<wordsToAdd; i++) {

    if (i && i%powerSpacing === 0 && yads<yadsToAdd) {

      elements.push({type:"power", idx:WORDS.length-1});

      yads++;

    }

    if (i >= vilaoStart && (i-vilaoStart)%vilaoSpacing === 0) {

      elements.push({type:"vilao"});

      vilaos++;

    }

    elements.push({type:"word", idx:shuffledWords[idx%shuffledWords.length], wordObj:shuffledWords[idx%shuffledWords.length]});

    idx++;

  }

  gameElements = elements;

}



window.addEventListener('resize', function adjustCanvas(){

  let canvas = document.getElementById("game");

  let ww = Math.min(window.innerWidth-10, 900);

  let wh = Math.max(320, Math.min(window.innerHeight-100, 500));

  canvas.width = ww; canvas.height = wh;

});

/* ---- FIM PARTE 1 ---- */

</script>

<!-- Solicite "continue" para receber a parte 2 (game engine, renderização, física e lógica do novo movimento) -->

</body>

</html>

// ======= GAME ENGINE, RENDERIZAÇÃO E LÓGICA =======



let player, cameraX, worldLength, groundY, wordPositions, currentWordIdx, challengeActive, challengeStartTime,

  points, wordsFound, keys, charImages, vidas, brilho, cruzes, viloes, gameOver, endGameType;



let challengeTimer = null, challengeTimeout = 16;

let bgImg = new window.Image();

bgImg.src = backgroundImageUrl;



// --- Parâmetros do cenário e movimentação

function startGame() {

  player = {

    // O personagem fica centralizado em X (exceto começo/final)

    x: 430, y: 320, width: 36, height: 66,

    vx: 0, vy: 0, speed: 4.2, onGround: true,

    gravity: 0.58, jumpPower: -10.6, direction: 1

  };

  cameraX = 0;

  groundY = 360;

  worldLength = 300 + gameElements.length*120 + 800;

  wordPositions = [];

  currentWordIdx = -1;

  challengeActive = false;

  challengeStartTime = 0;

  points = 200;

  wordsFound = 0;

  keys = {};

  vidas = 3;

  brilho = 0;

  cruzes = [];

  viloes = [];

  gameOver = false;

  endGameType = "";

  updateLives();

  generatePositions();

  loadCharImages().then(()=>{

    drawWorld();

    setTimeout(() => gameLoop(), 250);

  });

}



function loadCharImages() {

  return new Promise(resolve=>{

    charImages = [];

    let loads = 0;

    charImgs.forEach((src,i)=>{

      let img = new Image();

      img.src = src;

      img.onload = () => { charImages[i] = img; if(++loads===charImgs.length) resolve(); }

      img.onerror = () => { loads++; if(loads===charImgs.length) resolve();}

    });

  });

}



function generatePositions() {

  wordPositions = [];

  viloes = [];

  let baseX = 300;

  let lastY = 280; // Começa baixo

  for (let i=0,x=baseX; i<gameElements.length; i++) {

    let el = gameElements[i];

    // Para garantir altura alcançável:

    let minY = 220, maxY = groundY-54;

    let y = minY + Math.random() * (maxY-minY); 

    if (el.type==="vilao") {

      viloes.push({

        x:x, 

        y: groundY-66, // Vilão sempre na linha do chão, ajustado pelo corpo do boneco

        alive:true, cooldown:0

      });

    } else if (el.type==="word" || el.type==="power") {

      wordPositions.push({

        x:x, 

        y:y, 

        found:false, 

        idx:el.type==="word"?WORDS.indexOf(el.wordObj):WORDS.length-1, 

        type:el.type

      });

    }

    x += 120 + Math.random()*40;

    lastY = y;

  }

}



// --- DRAWING ---

const canvas = document.getElementById("game");

const ctx = canvas.getContext("2d");

function drawBackground() {

  if(bgImg.complete && bgImg.naturalWidth) {

    ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

  } else {

    ctx.fillStyle = "#7dd3fc";

    ctx.fillRect(0,0,canvas.width,canvas.height);

  }

  ctx.save();

  ctx.globalAlpha = 0.13;

  ctx.font = "bold 80px JetBrains Mono, monospace";

  ctx.fillStyle = "#2d2d5a";

  ctx.textAlign = "center";

  ctx.fillText("Rodrigo Niskier", canvas.width/2, canvas.height/2+30);

  ctx.restore();

}

function drawPlayer() {

  ctx.save();

  // Boneco SEM movimentar-se em X, sempre centralizado (exceto começo/fim)

  let px = player.x, py = player.y + player.height / 2;

  ctx.translate(px, py);

  ctx.scale(player.direction, 1);

  // Brilho de poder?

  if (brilho>0) {

    ctx.save();

    ctx.globalAlpha = Math.max(0.45, brilho/90);

    for(let i=0;i<16;i++){

      ctx.beginPath();

      ctx.arc(0,6,32+6*Math.sin(i+brilho/8),0,2*Math.PI);

      ctx.strokeStyle = `rgba(255,220,30,${0.26 + Math.random()*0.09})`;

      ctx.lineWidth = 8+Math.random()*6;

      ctx.shadowBlur = 17;

      ctx.shadowColor = "#ffe75a";

      ctx.stroke();

    }

    ctx.restore();

  }

  // Corpo, gravata, camisa, braços, pernas e cabeça (como antes)

  // Ombros e peito (paletó azul escuro)

  ctx.save();

  ctx.beginPath();

  ctx.moveTo(-21, -4);

  ctx.lineTo(21, -4);

  ctx.lineTo(15, 36);

  ctx.lineTo(-15, 36);

  ctx.closePath();

  ctx.fillStyle = "#273262";

  ctx.fill();

  ctx.strokeStyle = "#182042";

  ctx.lineWidth = 2.2;

  ctx.stroke();

  ctx.restore();

  // Camisa branca sob paletó

  ctx.save();

  ctx.beginPath();

  ctx.moveTo(-7, -4);

  ctx.lineTo(7, -4);

  ctx.lineTo(7, 24);

  ctx.lineTo(-7, 24);

  ctx.closePath();

  ctx.fillStyle = "#fff";

  ctx.fill();

  ctx.restore();

  // Gravata vermelha

  ctx.save();

  ctx.beginPath();

  ctx.arc(0, 0, 3.5, 0, 2 * Math.PI);

  ctx.fillStyle = "#be2323";

  ctx.fill();

  ctx.beginPath();

  ctx.moveTo(0, 3);

  ctx.lineTo(-5, 22);

  ctx.lineTo(5, 22);

  ctx.closePath();

  ctx.fillStyle = "#be2323";

  ctx.fill();

  ctx.restore();

  // Braços (paletó azul escuro)

  ctx.save();

  ctx.lineWidth = 9;

  ctx.strokeStyle = "#273262";

  ctx.beginPath();

  ctx.moveTo(-19, 2); ctx.lineTo(-29, 34);

  ctx.moveTo(19, 2); ctx.lineTo(29, 34);

  ctx.stroke();

  ctx.lineWidth = 6;

  ctx.strokeStyle = "#fff";

  ctx.beginPath();

  ctx.moveTo(-29, 34); ctx.lineTo(-29, 38);

  ctx.moveTo(29, 34); ctx.lineTo(29, 38);

  ctx.stroke();

  ctx.lineWidth = 6;

  ctx.strokeStyle = "#f9e5ce";

  ctx.beginPath();

  ctx.moveTo(-29, 39); ctx.lineTo(-29, 43);

  ctx.moveTo(29, 39); ctx.lineTo(29, 43);

  ctx.stroke();

  ctx.restore();

  // Pernas

  ctx.save();

  ctx.lineWidth = 9;

  ctx.strokeStyle = "#191d25";

  ctx.beginPath();

  ctx.moveTo(-7, 36); ctx.lineTo(-10, 63);

  ctx.moveTo(7, 36); ctx.lineTo(10, 63);

  ctx.stroke();

  ctx.lineWidth = 7.5;

  ctx.strokeStyle = "#353942";

  ctx.beginPath();

  ctx.moveTo(-10, 64); ctx.lineTo(-10, 67);

  ctx.moveTo(10, 64); ctx.lineTo(10, 67);

  ctx.stroke();

  ctx.restore();

  // Cabeça (imagem)

  ctx.save();

  ctx.beginPath();

  ctx.arc(0, -21, 18, 0, 2 * Math.PI);

  ctx.closePath();

  ctx.clip();

  if (charImages && charImages[selectedChar-1]) {

    ctx.drawImage(charImages[selectedChar-1], -18, -39, 36, 36);

  } else {

    ctx.fillStyle = "#f8e6d4";

    ctx.arc(0, -21, 17, 0, 2 * Math.PI);

    ctx.fill();

  }

  ctx.restore();

  ctx.restore();

}

function drawGround() {

  ctx.fillStyle = "#222b3e";

  ctx.fillRect(0, groundY, canvas.width, canvas.height-groundY);

  ctx.fillStyle = "#495980";

  ctx.fillRect(0, groundY+30, canvas.width, canvas.height-groundY-30);

  for(let i=0;i<40;i++){

    ctx.fillStyle = "#94a3b8";

    ctx.fillRect(i*100, groundY+30, 30, 7);

  }

}

function drawWords() {

  wordPositions.forEach((wp, k) => {

    if (!wp.found) {

      ctx.save();

      ctx.font = "2.2rem 'Noto Sans Hebrew', sans-serif";

      ctx.textAlign = "center";

      ctx.shadowColor = "#facc15";

      ctx.shadowBlur = wp.type==="power"?15:7;

      ctx.globalAlpha = wp.type==="power"?0.93:0.82;

      ctx.fillStyle = wp.type==="power"?"#ffe34d":"#fbbf24";

      // Convertemos x do mundo para x de tela:

      ctx.fillText(WORDS[wp.idx].he, worldToScreenX(wp.x), wp.y + 35);

      ctx.restore();

    }

  });

}

function drawViloes() {

  viloes.forEach((v)=>{

    if (!v.alive) return;

    let px = worldToScreenX(v.x), py = v.y+30;

    ctx.save();

    ctx.beginPath();

    ctx.arc(px, py-38, 18, 0, 2*Math.PI);

    ctx.closePath();

    ctx.clip();

    if (charImages[2]) ctx.drawImage(charImages[2], px-18, py-56, 36,36);

    ctx.restore();

    // Corpo preto longo

    ctx.save();

    ctx.beginPath();

    ctx.moveTo(px-17, py-19);

    ctx.lineTo(px+17, py-19);

    ctx.lineTo(px+12, py+37);

    ctx.lineTo(px-12, py+37);

    ctx.closePath();

    ctx.fillStyle = "#232323";

    ctx.fill();

    // Faixa branca (cinto)

    ctx.fillStyle = "#fff";

    ctx.fillRect(px-10, py+14, 20, 5);

    ctx.restore();

  });

}

function drawCruzes() {

  cruzes.forEach(cr=>{

    if (!cr.active) return;

    ctx.save();

    ctx.translate(worldToScreenX(cr.x), cr.y+player.height/2);

    ctx.rotate(cr.dir*0.08);

    ctx.globalAlpha = 0.9;

    ctx.lineWidth = 4;

    ctx.strokeStyle = "#ffe469";

    ctx.beginPath();

    ctx.moveTo(-7,0); ctx.lineTo(7,0);

    ctx.moveTo(0,-11); ctx.lineTo(0,11);

    ctx.stroke();

    ctx.lineWidth = 2;

    ctx.strokeStyle = "#fff";

    ctx.beginPath();

    ctx.moveTo(-6,0); ctx.lineTo(6,0);

    ctx.moveTo(0,-10); ctx.lineTo(0,10);

    ctx.stroke();

    ctx.restore();

  });

}

function drawWorld() {

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawBackground();

  drawGround();

  drawWords();

  drawViloes();

  drawCruzes();

  drawPlayer();

  ctx.save();

  ctx.globalAlpha = 0.15;

  ctx.font = "16px monospace";

  ctx.fillStyle = "#fff";

  ctx.fillText(`Pos: ${(getWorldX()|0)}/${worldLength}`, 35, 24);

  ctx.restore();

}



// O personagem fica centralizado em X, o mundo se move para a esquerda/direita

function worldToScreenX(x) {

  // Player sempre no meio da tela (ou início/fim)

  const centerX = Math.floor(canvas.width/2);

  const minWorldX = centerX;

  const maxWorldX = worldLength - centerX;

  let px = getWorldX();

  if (px < minWorldX) return x;

  if (px > maxWorldX) return x - (worldLength-canvas.width);

  return x - (px - centerX);

}

function getWorldX() {

  // Calcula a posição "virtual" do jogador no mundo

  return player.worldX !== undefined ? player.worldX : player.x;

}



// --- FÍSICA, MOVIMENTO, LÓGICA ---

function updatePlayer() {

  // O player em si só se move verticalmente; horizontalmente, é o mundo que "anda"

  player.vx = 0;

  if (keys["ArrowLeft"]) { moveWorld(-player.speed); player.direction = -1;}

  if (keys["ArrowRight"]) { moveWorld(+player.speed); player.direction = 1;}

  if (keys["ArrowUp"] && player.onGround) {

    player.vy = player.jumpPower; player.onGround = false;

  }

  player.vy += player.gravity;

  player.y += player.vy;

  if (player.y + player.height >= groundY+2) {

    player.y = groundY - player.height + 2;

    player.vy = 0;

    player.onGround = true;

  }

  if (player.y < 80) { player.y = 80; player.vy = 0; }

}



function moveWorld(dx) {

  // A variável player.worldX representa a posição real do jogador no mundo (invisível)

  if (player.worldX === undefined) player.worldX = player.x;

  player.worldX += dx;

  if (player.worldX < 0) player.worldX = 0;

  if (player.worldX > worldLength-player.width) player.worldX = worldLength-player.width;

}



function checkWordCollision() {

  if (challengeActive) return;

  for (let i = 0; i < wordPositions.length; i++) {

    let wp = wordPositions[i];

    if (!wp.found &&

      Math.abs(getWorldX() - wp.x) < 50 &&

      player.y + player.height > wp.y &&

      player.y < wp.y + 54) {

      currentWordIdx = i;

      if (wp.type==="power") {

        points += 100; brilho = 90;

        document.getElementById('scoreValue').textContent = points;

        wp.found = true;

        setTimeout(()=>{ brilho=0; },3000);

        return;

      } else {

        triggerChallenge(wp.idx);

        break;

      }

    }

  }

}

function checkVilaoCollision() {

  if (challengeActive) return;

  viloes.forEach((v) => {

    if (!v.alive) return;

    if (

      Math.abs(getWorldX() - v.x) < 45 &&

      player.y + player.height > v.y-5 &&

      player.y < v.y + 50

    ) {

      if (v.cooldown <= 0) {

        points -= 50;

        updatePoints();

        v.cooldown = 50;

        brilho = 0;

        if (points < 0) {

          loseLife();

        }

      }

    }

    if (v.cooldown > 0) v.cooldown--;

  });

}

function checkCruzCollision() {

  cruzes.forEach(cr=>{

    if (!cr.active) return;

    viloes.forEach((v)=>{

      if (!v.alive) return;

      if (

        Math.abs(cr.x - v.x) < 35 &&

        cr.y + 20 > v.y &&

        cr.y < v.y + 50

      ) {

        v.alive = false;

        cr.active = false;

      }

    });

  });

}

function updatePoints() {

  document.getElementById('scoreValue').textContent = Math.max(0, points);

}

function loseLife() {

  vidas--;

  updateLives();

  if (vidas > 0) {

    player.y = 320; player.worldX = 80; points = 200; updatePoints();

  } else {

    endGameType = "over";

    showEndModal();

  }

}

function updateLives() {

  let html = "";

  for (let i=0; i<vidas; i++) html += `<span class="lives-heart">♥</span>`;

  document.getElementById('lives').innerHTML = html;

}

function fireCruz() {

  if (points<100) return;

  let dir = player.direction || 1;

  cruzes.push({

    x: getWorldX()+(dir>0?26:-6), y: player.y+16,

    vx: dir*11, dir: dir, active:true, t:0

  });

  points -= 100; updatePoints();

}

function updateCruzes() {

  cruzes.forEach(cr=>{

    if (!cr.active) return;

    cr.x += cr.vx; cr.t++;

    if (cr.x<0 || cr.x>worldLength || cr.t>60) cr.active = false;

  });

}



// --- DESAFIO DE PALAVRA ---

function triggerChallenge(wordIdx) {

  challengeActive = true; usedHint = false;

  document.getElementById('modal').classList.remove('hidden');

  document.getElementById('hebrewWord').textContent = WORDS[wordIdx].he;

  document.getElementById('answerInput').value = "";

  document.getElementById('feedback').textContent = "";

  document.getElementById('hint').textContent = "";

  document.getElementById('answerInput').focus();

  document.getElementById('hintBtn').disabled = false;

  challengeStartTime = performance.now();

  let timerEl = document.getElementById('timer');

  timerEl.textContent = `Tempo: ${challengeTimeout.toFixed(1)}s`;

  let secondsElapsed = 0;

  clearInterval(challengeTimer);

  challengeTimer = setInterval(() => {

    let now = performance.now();

    secondsElapsed = (now - challengeStartTime)/1000;

    let left = Math.max(0, challengeTimeout - secondsElapsed);

    timerEl.textContent = `Tempo: ${left.toFixed(1)}s`;

    if (left <= 0) {

      clearInterval(challengeTimer);

      failChallenge();

    }

  }, 90);

}

document.getElementById('hintBtn').addEventListener('click', function() {

  if (challengeActive && !usedHint) {

    let idx = wordPositions[currentWordIdx].idx;

    document.getElementById('hint').textContent = WORDS[idx].dica || "Sem dica.";

    usedHint = true;

    this.disabled = true;

  }

});

document.getElementById('answerForm').addEventListener('submit', function(e){

  e.preventDefault();

  if (!challengeActive) return;

  let answer = normalize(document.getElementById('answerInput').value);

  let word = WORDS[wordPositions[currentWordIdx].idx];

  let accepted = word.pt.some(t => normalize(t) === answer);

  if (accepted) {

    completeChallenge();

  } else {

    document.getElementById('feedback').textContent = "Tradução incorreta. Tente novamente!";

  }

});

function completeChallenge() {

  let timeTaken = (performance.now() - challengeStartTime)/1000;

  let pts = Math.round(

    usedHint ?

      Math.max(10, 60 - 3.5*timeTaken) :

      Math.max(20, 100 - 5*timeTaken)

  );

  points += pts;

  wordsFound++;

  wordPositions[currentWordIdx].found = true;

  updatePoints();

  document.getElementById('feedback').textContent = usedHint

    ? `Correto! +${pts} pts (com dica)`

    : `Correto! +${pts} pts`;

  setTimeout(()=>{

    document.getElementById('modal').classList.add('hidden');

    challengeActive = false;

    if (wordsFound === wordPositions.length) {

      endGameType = "win";

      showEndModal();

    }

  }, 600);

  clearInterval(challengeTimer);

}

function failChallenge() {

  document.getElementById('feedback').textContent = `Tempo esgotado! Resposta: ${WORDS[wordPositions[currentWordIdx].idx].pt[0]}`;

  setTimeout(()=>{

    document.getElementById('modal').classList.add('hidden');

    challengeActive = false;

    wordsFound++;

    wordPositions[currentWordIdx].found = true;

    if (wordsFound === wordPositions.length) {

      endGameType = "win";

      showEndModal();

    }

  }, 1200);

  clearInterval(challengeTimer);

}

function showEndModal() {

  document.getElementById('endModal').classList.remove('hidden');

  if (endGameType==="win") {

    document.getElementById('endTitle').innerHTML = '<span class="hebrew">מַזָּל טוֹב</span>';

    document.getElementById('endMsg').textContent = "Parabéns, você venceu!";

  } else {

    document.getElementById('endTitle').textContent = "Game Over";

    document.getElementById('endMsg').textContent = "Tente novamente!";

  }

}



// --- GAMELOOP ---

function gameLoop() {

  if (gameOver) return;

  if (!challengeActive) {

    updatePlayer();

    updateCruzes();

    checkWordCollision();

    checkVilaoCollision();

    checkCruzCollision();

    brilho = Math.max(0, brilho-1);

  }

  drawWorld();

  requestAnimationFrame(gameLoop);

}



// --- CONTROLES ---

document.addEventListener('keydown', function(e){

  if (["ArrowUp", "ArrowLeft", "ArrowRight"].includes(e.code)) keys[e.code] = true;

  if (e.code==="Space" && !challengeActive) fireCruz();

  if (challengeActive && e.code === "Escape") {

    document.getElementById('modal').classList.add('hidden');

    challengeActive = false;

    clearInterval(challengeTimer);

  }

});

document.addEventListener('keyup', function(e){

  if (["ArrowUp", "ArrowLeft", "ArrowRight"].includes(e.code)) keys[e.code] = false;

});



// Controles Touch

if (document.getElementById('btnLeft')) {

  let btns = [

    {id: 'btnLeft', code: 'ArrowLeft'},

    {id: 'btnRight', code: 'ArrowRight'},

    {id: 'btnUp', code: 'ArrowUp'}

  ];

  btns.forEach(({id, code}) => {

    let btn = document.getElementById(id); let timer;

    btn.addEventListener('touchstart', function(e) {

      e.preventDefault(); keys[code] = true; timer = setInterval(()=>{ keys[code]=true; }, 80);

    }, {passive: false});

    btn.addEventListener('touchend', function(e) {

      e.preventDefault(); keys[code] = false; if (timer) clearInterval(timer);

    }, {passive: false});

    btn.addEventListener('touchcancel', function(e) { keys[code] = false; if (timer) clearInterval(timer); }, {passive: false});

  });

  // Botão de atirar

  let btnFire = document.getElementById('btnFire');

  btnFire.addEventListener('touchstart', function(e) {

    e.preventDefault(); fireCruz();

  }, {passive: false});

}



// --- INICIALIZAÇÃO ---

function adjustCanvas() {

  let ww = Math.min(window.innerWidth-10, 900);

  let wh = Math.max(320, Math.min(window.innerHeight-100, 500));

  canvas.width = ww; canvas.height = wh;

}

window.addEventListener('resize', adjustCanvas);

adjustCanvas();



setupMapElements();



</script>
